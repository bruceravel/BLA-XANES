<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Xray::BLA::Mask &mdash; Xray::BLA and Metis 4 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/metis_icon.ico"/>
    <link rel="top" title="Xray::BLA and Metis 4 documentation" href="../../../index.html" />
    <link rel="up" title="Programming documentation" href="../../index.html" />
    <link rel="next" title="Xray::BLA::Pause" href="Pause.html" />
    <link rel="prev" title="Xray::BLA::Image" href="Image.html" />

    <link rel="stylesheet" type="text/css" href="../../../_static/demeter.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/keys.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/program.css" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Pause.html" title="Xray::BLA::Pause"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Image.html" title="Xray::BLA::Image"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Xray::BLA and Metis 4 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Programming documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="xray-bla-mask">
<h1>Xray::BLA::Mask<a class="headerlink" href="#xray-bla-mask" title="Permalink to this headline">¶</a></h1>
<div class="section" id="name">
<h2>NAME<a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h2>
<p>Xray::BLA::Mask - Role containing mask creation steps</p>
</div>
<div class="section" id="version">
<h2>VERSION<a class="headerlink" href="#version" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference external" href="https://metacpan.org/pod/Xray%3a%3aBLA">Xray::BLA</a></p>
</div>
<div class="section" id="methods">
<h2>METHODS<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<div class="section" id="general-methods">
<h3>General methods<a class="headerlink" href="#general-methods" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">mask</span></code></p>
<blockquote>
<div><p>Create a mask from the elastic image measured at the energy given by
<code class="docutils literal"><span class="pre">energy</span></code>.</p>
<div class="highlight-perl"><div class="highlight"><pre><span></span><span class="nv">$spectrum</span><span class="o">-&gt;</span><span class="n">mask</span><span class="p">(</span><span class="nv">@args</span><span class="p">);</span>
</pre></div>
</div>
<p>where the arguments are given using fat commas, as in <code class="docutils literal"><span class="pre">verbose=</span></code>0,
save=&gt;0, animate=&gt;0&gt;.</p>
<p>The arguments are:</p>
<p><code class="docutils literal"><span class="pre">verbose</span></code></p>
<blockquote>
<div>When true, this causes messages to be printed to standard output with
information about each stage of mask creation.  Only used in CLI mode.</div></blockquote>
<p><code class="docutils literal"><span class="pre">save</span></code></p>
<blockquote>
<div>When true, this causes an image file to be saved at each stage of
processing the mask.  Usually only used in CLI mode.</div></blockquote>
<p><code class="docutils literal"><span class="pre">animate</span></code></p>
<blockquote>
<div>This causes a properly scaled animation to be written showing the
stages of mask creation.</div></blockquote>
<p><code class="docutils literal"><span class="pre">elastic</span></code></p>
<blockquote>
<div>Explicitly specify a file to use as the elastic image.  In CLI mode,
this is usually determined algorithmicly, but in Metis it is taken
from one of the image lists on the Files page.</div></blockquote>
<p><code class="docutils literal"><span class="pre">unity</span></code></p>
<blockquote>
<div>??</div></blockquote>
<p><code class="docutils literal"><span class="pre">pass</span></code></p>
<blockquote>
<div>This is a counter for multiple passes of the <code class="docutils literal"><span class="pre">social</span></code> step.</div></blockquote>
<p><code class="docutils literal"><span class="pre">vertical</span></code></p>
<blockquote>
<div>When true, this tells the <code class="docutils literal"><span class="pre">social</span></code> step to only consider pixels
directly above and below.</div></blockquote>
<p><code class="docutils literal"><span class="pre">plot</span></code></p>
<blockquote>
<div>When true, this will generate a plot at each stage of mask creation
along with a pause for viewing it.  This is only used in CLI mode.</div></blockquote>
<p><code class="docutils literal"><span class="pre">write</span></code></p>
<blockquote>
<div>When given a filename, an image file will be written at the end of a
mask creation step.  When given a false value, the image file will be
written.</div></blockquote>
<p>These output image files are gif on linux and tif on Windows.</p>
<p>This method is a wrapper around the contents of the
<code class="docutils literal"><span class="pre">steps</span></code> attribute.  Each entry in <code class="docutils literal"><span class="pre">steps</span></code> will be parsed and
executed in sequence.</p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">check</span></code></p>
<blockquote>
<div>Verify that the elastic image file exists, can be read, and be
imported as an image file.  This sets the <code class="docutils literal"><span class="pre">elastic_file</span></code> and
<code class="docutils literal"><span class="pre">elastic_image</span></code> attributes.</div></blockquote>
<p><code class="docutils literal"><span class="pre">remove_bad_pixels</span></code></p>
<blockquote>
<div>This removes the bad pixels from the map using the
<code class="docutils literal"><span class="pre">bad_pixel_mask</span></code> attribute.  Some of the steps, <code class="docutils literal"><span class="pre">areal</span></code> for example,
can reinsert a bad pixel, so it is necessary to follow each step with
this method to ensure that the bad pixels are not used in HERFD
processing.</div></blockquote>
<p><code class="docutils literal"><span class="pre">do_step</span></code></p>
<blockquote>
<div>A wrapper around the various mask processing steps.  This calls the
various steps, manages screen messages, sets some attributes, manages
plotting in CLI mode, and manages saving images of steps in the mask
creation process when in CLI mode.  In Metis, this is usually called
directly without calling the <code class="docutils literal"><span class="pre">mask</span></code> method.</div></blockquote>
</div>
<div class="section" id="methods-for-the-steps-of-mask-creation">
<h3>Methods for the steps of mask creation<a class="headerlink" href="#methods-for-the-steps-of-mask-creation" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">bad_pixels</span></code></p>
<blockquote>
<div><p>Remove pixels that are larger than the value of the <code class="docutils literal"><span class="pre">bad_pixel_value</span></code>attribute and smaller than the <code class="docutils literal"><span class="pre">weak_pixel_value</span></code> attribute.  This
must be the first step in mask processing.  This also sets the
<code class="docutils literal"><span class="pre">bad_pixel_mask</span></code> attribute, which identifies the pixels marked as bad
pixels.</p>
<p>Controlling attributes: <code class="docutils literal"><span class="pre">bad_pixel_value</span></code>, <code class="docutils literal"><span class="pre">weak_pixel_value</span></code></p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">gaussian_blur</span></code></p>
<blockquote>
<div><p>Apply an approximate Gaussian blur filter to the image.  Set all
pixels above a threshold value to 1, setting all below that value to
0.  This is a simple convolution with this kernel:</p>
<div class="highlight-perl"><div class="highlight"><pre><span></span>  <span class="mi">1</span>   <span class="o">/</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">1</span> <span class="o">\</span>
<span class="o">----</span> <span class="p">(</span>  <span class="mi">2</span> <span class="mi">4</span> <span class="mi">2</span>  <span class="p">)</span>
 <span class="mi">16</span>   <span class="o">\</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">1</span> <span class="o">/</span>
</pre></div>
</div>
<p>The size of the threshold depends on the intensity of the relevant
part of the image.  Very bright, spurious spots will pass through this
filter.</p>
<p>Controlling attribute: <code class="docutils literal"><span class="pre">gaussian_blur_value</span></code></p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">useshield</span></code></p>
<blockquote>
<div><p>Construct a shield used to mask out a region of the elastic image
associated with fluorescence or some other source of signal.</p>
<p>Shields are constructed sequentially.  The first N steps do not have a
shield -- more specifically, the shield is empty.  The next shield
uses the mask from N steps prior to block out this signal.  The
following shield adds the mask from N steps back to the shield of
the previous step.  Subsequent steps accumulate the masks from N
steps back, adding them to their shields.</p>
<p>All pixels under the shield are then set to 0.</p>
<p>Controlling attribute: <code class="docutils literal"><span class="pre">shield</span></code></p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">polyfill</span></code></p>
<blockquote>
<div><p>After the Gaussian blur or other filtering step to remove all of the
outlying pixels, the top-most and bottom-most pixels in each column
are noted.  Two polynomials are fit to this collection of points, one
to the top set and one to the bottom set.  The pixels between the two
polynomials are turned on, yielding the final mask.</p>
<p>Controlling attributes: none.</p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">lonely_pixels</span></code></p>
<blockquote>
<div><p>Remove illuminated pixels which are not surrounded by enough other
illuminated pixels.</p>
<p>Controlling attribute: <code class="docutils literal"><span class="pre">lonely_pixel_value</span></code></p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">social_pixels</span></code></p>
<blockquote>
<div><p>Include dark pixels which are surrounded by enough illuminated pixels.</p>
<p>Controlling attribute: <code class="docutils literal"><span class="pre">social_pixel_value</span></code></p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">areal</span></code></p>
<blockquote>
<div><p>At each point in the mask, assign its value to the median or mean
value of a square centered on that point.  The size of the square is
determined by the value of the <code class="docutils literal"><span class="pre">radius</span></code> attribute.</p>
<p>The median operation is not currently supported.</p>
<p>Controlling attributes: <code class="docutils literal"><span class="pre">operation</span></code>, <code class="docutils literal"><span class="pre">radius</span></code></p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">multiply</span></code></p>
<blockquote>
<div><p>Multiply the entire image by a scaling factor.</p>
<p>Controlling attribute: <code class="docutils literal"><span class="pre">scalemask</span></code></p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">entire_image</span></code></p>
<blockquote>
<div><p>Set every pixel in the mask to 1.  This makes the &quot;HERFD&quot; using the
entire image at each energy point.  This is used for testing and
demonstration purposes and is not actually a useful step for making
high energy resolution data.</p>
<p>Controlling attributes: none</p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">mapmask</span></code></p>
<blockquote>
<div>(coming soon)</div></blockquote>
<p><code class="docutils literal"><span class="pre">andmask</span></code></p>
<blockquote>
<div><p>This is the final step in mask creation.  It sets all non-zero pixels
to 1 so that the mask can be directly multiplied by images at each
data point in a HERFD scan.</p>
<p>Controlling attributes: none</p>
</div></blockquote>
</div>
</div>
<div class="section" id="author">
<h2>AUTHOR<a class="headerlink" href="#author" title="Permalink to this headline">¶</a></h2>
<p>Bruce Ravel (bravel AT bnl DOT gov)</p>
<p><a class="reference external" href="http://github.com/bruceravel/BLA-XANES">http://github.com/bruceravel/BLA-XANES</a></p>
</div>
<div class="section" id="licence-and-copyright">
<h2>LICENCE AND COPYRIGHT<a class="headerlink" href="#licence-and-copyright" title="Permalink to this headline">¶</a></h2>
<p>Copyright (c) 2011-2014,2016 Bruce Ravel, Jeremy Kropf. All
rights reserved.</p>
<p>This module is free software; you can redistribute it and/or modify it
under the same terms as Perl itself. See <a class="reference external" href="http://perldoc.perl.org/perlgpl.html">perlgpl</a>.</p>
<p>This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>

<br>

<br>
<hr class="docutils" />
<p><strong class="program">Xray::BLA</strong> and <font size=-1 color="#8C4112">METIS</font> are copyright ©
2011-2014, 2016 Bruce Ravel and Jeremy Kropf – This document is
copyright © 2016 Bruce Ravel</p>
<p>This document is licensed under <a class="reference external" href="http://creativecommons.org/licenses/by-sa/3.0/">The Creative Commons Attribution-ShareAlike License</a>.</p>
<p>If this software and its documentation are useful to you, please
consider <a class="reference external" href="http://creativecommons.org/support/">supporting The Creative Commons</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/metis.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../exp/index.html">The bent Laue experiment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bla/index.html">The bla program</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../metis/index.html">The Metis program</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plotting.html">Plotting and visualization</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Programming documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../BLA.html">Xray::BLA</a></li>
<li class="toctree-l2"><a class="reference internal" href="IO.html">Xray::BLA::IO</a></li>
<li class="toctree-l2"><a class="reference internal" href="Image.html">Xray::BLA::Image</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Xray::BLA::Mask</a></li>
<li class="toctree-l2"><a class="reference internal" href="Pause.html">Xray::BLA::Pause</a></li>
<li class="toctree-l2"><a class="reference internal" href="Plot.html">Xray::BLA::Plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="Return.html">Xray::BLA::Return</a></li>
<li class="toctree-l2"><a class="reference internal" href="Tools.html">Xray::BLA::Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Demeter/UI/Metis.html">Demeter::UI::Metis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Demeter/UI/Metis/Files.html">Demeter::UI::Metis::Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Demeter/UI/Metis/Mask.html">Demeter::UI::Metis::Mask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Demeter/UI/Metis/Data.html">Demeter::UI::Metis::Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Demeter/UI/Metis/Config.html">Demeter::UI::Metis::Config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Demeter/UI/Metis/Cursor.html">Demeter::UI::Metis::Cursor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Demeter/UI/Metis/PluckPoint.html">Demeter::UI::Metis::PluckPoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Demeter/UI/Metis/LastPlot.html">Demeter::UI::Metis::LastPlot</a></li>
</ul>
</li>
</ul>
<h3>Helpful Links</h3>
<p>Current version: <b>4</b></p>

<ul>
  <li>&nbsp; &nbsp; <a href="https://github.com/bruceravel/BLA-XANES/">BLA @ github</a>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/">Demeter homepage</a>
  <li>&nbsp; &nbsp; <a href="https://github.com/bruceravel/demeter/">Demeter @ github</a>
</ul>
<ul>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/documents/SinglePage/bugs.html">Bug reporting hints</a>
  <li>&nbsp; &nbsp; <a href="http://bruceravel.github.io/demeter/documents/SinglePage/help.html">How to ask a good question</a>
</ul>
<p>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/lib/Xray/BLA/Mask.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Pause.html" title="Xray::BLA::Pause"
             >next</a> |</li>
        <li class="right" >
          <a href="Image.html" title="Xray::BLA::Image"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Xray::BLA and Metis 4 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Programming documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Bruce Ravel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
  </body>
</html>